Description: Add support for attributewhitelist
 The handling is essentially the same as how the standard blacklist and
 whitelist are handled.
 See also www/fetch.php and lib/MetaLoader.php
Author: Mischa Sall√© <msalle@nikhef.nl>
Author: Tamas Balogh <tamasb@nikhef.nl>
--- a/modules/metarefresh/hooks/hook_cron.php	2019-10-04 23:12:31.000000000 +0200
+++ b/modules/metarefresh/hooks/hook_cron.php	2019-11-21 21:42:21.053693358 +0100
@@ -56,9 +56,10 @@
 
             $metaloader = new \SimpleSAML\Module\metarefresh\MetaLoader($expire, $stateFile, $oldMetadataSrc);
 
-            // Get global blacklist, whitelist and caching info
+            // Get global blacklist, whitelist, attributewhitelist and caching info
             $blacklist = $mconfig->getArray('blacklist', []);
             $whitelist = $mconfig->getArray('whitelist', []);
+            $attributewhitelist = $mconfig->getArray('attributewhitelist', []);
             $conditionalGET = $mconfig->getBoolean('conditionalGET', false);
 
             // get global type filters
@@ -93,6 +94,13 @@
                     $source['whitelist'] = $whitelist;
                 }
 
+                # Merge global and src specific attributewhitelists: cannot use array_unique for multi-dim.
+                if (isset($source['attributewhitelist'])) {
+                    $source['attributewhitelist'] = array_merge($source['attributewhitelist'], $attributewhitelist);
+                } else {
+                    $source['attributewhitelist'] = $attributewhitelist;
+                }
+
                 // Let src specific conditionalGET override global one
                 if (!isset($source['conditionalGET'])) {
                     $source['conditionalGET'] = $conditionalGET;
